{"ast":null,"code":"import _asyncToGenerator from \"/Users/marinemichelot/Desktop/Aston/P1/gitcant/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../service/order.service\";\nimport * as i2 from \"../service/date.service\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"../shared/week-picker/week-picker.component\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"./search/order-user-search/order-user-search.component\";\nimport * as i8 from \"./user-item/order-item.component\";\nimport * as i9 from \"../shared/filter.pipe\";\n\nfunction UserlistOrdersComponent_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"option\", 12);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n\n  if (rf & 2) {\n    const status_r3 = ctx.$implicit;\n    i0.ÉµÉµproperty(\"value\", status_r3.status);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate(status_r3.name);\n  }\n}\n\nfunction UserlistOrdersComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ÉµÉµgetCurrentView();\n\n    i0.ÉµÉµelementStart(0, \"div\", 13);\n    i0.ÉµÉµlistener(\"click\", function UserlistOrdersComponent_div_14_Template_div_click_0_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r7);\n      const i_r5 = restoredCtx.index;\n      const ctx_r6 = i0.ÉµÉµnextContext();\n      return ctx_r6.selectDay(i_r5);\n    });\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n\n  if (rf & 2) {\n    const day_r4 = ctx.$implicit;\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate1(\" \", day_r4.day, \" \");\n  }\n}\n\nfunction UserlistOrdersComponent_ng_container_16_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ÉµÉµgetCurrentView();\n\n    i0.ÉµÉµelementContainerStart(0);\n    i0.ÉµÉµelementStart(1, \"app-order-item\", 15);\n    i0.ÉµÉµlistener(\"orderDelete\", function UserlistOrdersComponent_ng_container_16_ng_container_1_Template_app_order_item_orderDelete_1_listener($event) {\n      i0.ÉµÉµrestoreView(_r11);\n      const ctx_r10 = i0.ÉµÉµnextContext(2);\n      return ctx_r10.deleteOrder($event);\n    })(\"orderDeliver\", function UserlistOrdersComponent_ng_container_16_ng_container_1_Template_app_order_item_orderDeliver_1_listener($event) {\n      i0.ÉµÉµrestoreView(_r11);\n      const ctx_r12 = i0.ÉµÉµnextContext(2);\n      return ctx_r12.deliverAndPayOrder($event);\n    });\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const order_r8 = i0.ÉµÉµnextContext().$implicit;\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"orderInput\", order_r8);\n  }\n}\n\nfunction UserlistOrdersComponent_ng_container_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementContainerStart(0);\n    i0.ÉµÉµtemplate(1, UserlistOrdersComponent_ng_container_16_ng_container_1_Template, 2, 1, \"ng-container\", 14);\n    i0.ÉµÉµelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const order_r8 = ctx.$implicit;\n    const ctx_r2 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", order_r8.creationDate === ctx_r2.weekDays[ctx_r2.i_day].date);\n  }\n}\n\nexport let UserlistOrdersComponent = /*#__PURE__*/(() => {\n  class UserlistOrdersComponent {\n    //---------------------- Constructeur --------------------------\n    constructor(orderService, dateService, toastr) {\n      this.orderService = orderService;\n      this.dateService = dateService;\n      this.toastr = toastr;\n      this.orders$ = of([]);\n      this.search = '';\n      this.statusSelected = 0;\n      this.statusList = [{\n        name: \"En Attente\",\n        status: 0\n      }, {\n        name: \"LivrÃ©e\",\n        status: 1\n      }, {\n        name: \"AnnulÃ©e\",\n        status: 2\n      }];\n      this.dateToday = new Date().toISOString().substring(0, 10);\n      this.i_day = 0;\n      this.dateSelect = \"\";\n      this.weekDays = [{\n        day: \"Monday\",\n        date: \"\"\n      }, {\n        day: \"Tuesday\",\n        date: \"\"\n      }, {\n        day: \"Wednesday\",\n        date: \"\"\n      }, {\n        day: \"Thursday\",\n        date: \"\"\n      }, {\n        day: \"Friday\",\n        date: \"\"\n      }];\n      this.searchStr = \"\";\n    } //---------------------- On Init --------------------------\n\n\n    ngOnInit() {\n      this.orders$ = this.orderService.getAllOrdersForDate$('2019-01-01', this.dateToday, 0);\n      let todayDate = new Date();\n      let todayDay = todayDate.getDay() - 1;\n      todayDate = todayDate.getMonth() + 1 + \"/\" + todayDate.getDate() + \"/\" + todayDate.getFullYear();\n      this.onDateChange(todayDate);\n      this.selectDay(todayDay);\n    } //---------------------- Changement de Date (week picker) --------------------------\n\n\n    onDateChange(val) {\n      let cpt = 2; //appel du service order pour recuperer les commandes d'une date donnÃ©e\n\n      this.dateSelect = val;\n      this.orders$ = this.orderService.getAllOrdersForDate$(this.dateService.getMondayFromDate(new Date(val)).toISOString().substring(0, 10), this.dateService.getFridayFromDate(new Date(val)).toISOString().substring(0, 10), this.statusSelected); // mise a jour du filtre des dates\n\n      this.weekDays.forEach(e => {\n        let d = new Date(val);\n        d.setDate(d.getDate() - d.getDay() + cpt);\n        e.date = d.toISOString().substring(0, 10);\n        cpt++;\n      });\n    } //---------------------- Selection de jour --------------------------\n\n\n    selectDay(i) {\n      this.i_day = i;\n    } //---------------------- Suppression d'une commande --------------------------\n\n\n    deleteOrder(id) {\n      this.orderService.deleteOrder(id);\n      this.orders$ = this.orders$.pipe(map(orders => orders.filter(order => order.id != id)));\n    } //---------------------- Delivrer et payer une commande --------------------------\n\n\n    deliverAndPayOrder(id) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        //requete asynchrone pour delivrer et payer une commande\n        try {\n          //appel du service Order pour recuperer et payer la commande\n          yield _this.orderService.deliverAndPayOrder(id);\n          _this.orders$ = _this.orders$.pipe(map(orders => orders.filter(order => order.id != id)));\n        } catch (e) {\n          //GESTION DES ERREURS ET MESSAGES D'ERREURS\n          if (e['status'] == 412) {\n            _this.toastr.error(\"Credit Insuffisant , veuillez jeuner !\");\n          } else {\n            _this.toastr.error('Chef, chef ! On a un problÃ¨me ðŸ˜¦ ' + e['status'] + ' ' + e.error['exceptionMessage']);\n          }\n        }\n      })();\n    } //---------------------- Track order by id --------------------------\n\n\n    trackByOrderId(order) {\n      return order.id;\n    } //---------------------- On Search criteria --------------------------\n\n\n    onSearch(criteria) {\n      this.search = criteria;\n    }\n\n    onStatusSelect() {\n      this.orders$ = this.orderService.getAllOrdersForDate$(this.dateService.getMondayFromDate(new Date(this.dateSelect)).toISOString().substring(0, 10), this.dateService.getFridayFromDate(new Date(this.dateSelect)).toISOString().substring(0, 10), this.statusSelected);\n    }\n\n    onTMPStatusSelect() {\n      this.orders$ = this.orderService.getAllOrdersForDate$(this.dateService.getMondayFromDate(new Date('2019-01-01')).toISOString().substring(0, 10), this.dateService.getFridayFromDate(new Date(this.dateToday)).toISOString().substring(0, 10), this.statusSelected);\n    }\n\n  }\n\n  UserlistOrdersComponent.Éµfac = function UserlistOrdersComponent_Factory(t) {\n    return new (t || UserlistOrdersComponent)(i0.ÉµÉµdirectiveInject(i1.OrderService), i0.ÉµÉµdirectiveInject(i2.DateService), i0.ÉµÉµdirectiveInject(i3.ToastrService));\n  };\n\n  UserlistOrdersComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n    type: UserlistOrdersComponent,\n    selectors: [[\"app-userlist-orders\"]],\n    inputs: {\n      search: \"search\"\n    },\n    decls: 19,\n    vars: 10,\n    consts: [[1, \"container\"], [1, \"filters\"], [3, \"dateEvent\"], [\"for\", \"filter\"], [\"name\", \"filter\", \"id\", \"filterStatus\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"search\"], [1, \"main\"], [1, \"week-container\"], [\"class\", \"day\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"users\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"value\"], [1, \"day\", 3, \"click\"], [4, \"ngIf\"], [3, \"orderInput\", \"orderDelete\", \"orderDeliver\"]],\n    template: function UserlistOrdersComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ÉµÉµelementStart(0, \"section\", 0);\n        i0.ÉµÉµelementStart(1, \"h2\");\n        i0.ÉµÉµtext(2, \"Liste des Commandes\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(3, \"div\", 1);\n        i0.ÉµÉµelementStart(4, \"div\");\n        i0.ÉµÉµelementStart(5, \"app-week-picker\", 2);\n        i0.ÉµÉµlistener(\"dateEvent\", function UserlistOrdersComponent_Template_app_week_picker_dateEvent_5_listener($event) {\n          return ctx.onDateChange($event);\n        });\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(6, \"div\");\n        i0.ÉµÉµelement(7, \"label\", 3);\n        i0.ÉµÉµelementStart(8, \"select\", 4);\n        i0.ÉµÉµlistener(\"ngModelChange\", function UserlistOrdersComponent_Template_select_ngModelChange_8_listener($event) {\n          return ctx.statusSelected = $event;\n        })(\"change\", function UserlistOrdersComponent_Template_select_change_8_listener() {\n          return ctx.onTMPStatusSelect();\n        });\n        i0.ÉµÉµtemplate(9, UserlistOrdersComponent_option_9_Template, 2, 2, \"option\", 5);\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(10, \"app-order-user-search\", 6);\n        i0.ÉµÉµlistener(\"search\", function UserlistOrdersComponent_Template_app_order_user_search_search_10_listener($event) {\n          return ctx.onSearch($event);\n        });\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelement(11, \"hr\");\n        i0.ÉµÉµelementStart(12, \"div\", 7);\n        i0.ÉµÉµelementStart(13, \"div\", 8);\n        i0.ÉµÉµtemplate(14, UserlistOrdersComponent_div_14_Template, 2, 1, \"div\", 9);\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(15, \"div\", 10);\n        i0.ÉµÉµtemplate(16, UserlistOrdersComponent_ng_container_16_Template, 2, 1, \"ng-container\", 11);\n        i0.ÉµÉµpipe(17, \"OrderUserfilter\");\n        i0.ÉµÉµpipe(18, \"async\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ÉµÉµadvance(8);\n        i0.ÉµÉµproperty(\"ngModel\", ctx.statusSelected);\n        i0.ÉµÉµadvance(1);\n        i0.ÉµÉµproperty(\"ngForOf\", ctx.statusList);\n        i0.ÉµÉµadvance(5);\n        i0.ÉµÉµproperty(\"ngForOf\", ctx.weekDays);\n        i0.ÉµÉµadvance(2);\n        i0.ÉµÉµproperty(\"ngForOf\", i0.ÉµÉµpipeBind2(17, 5, i0.ÉµÉµpipeBind1(18, 8, ctx.orders$), ctx.search))(\"ngForTrackBy\", ctx.trackByOrderId);\n      }\n    },\n    directives: [i4.WeekPickerComponent, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgModel, i6.NgForOf, i7.OrderUserSearchComponent, i5.NgSelectOption, i5.ÉµNgSelectMultipleOption, i6.NgIf, i8.OrderItemComponent],\n    pipes: [i9.OrderFilterPipe, i6.AsyncPipe],\n    styles: [\".container[_ngcontent-%COMP%]{width:80%;margin-left:auto;margin-right:auto;margin-top:2em}.filters[_ngcontent-%COMP%]{display:flex;width:80%;justify-content:space-between}select[_ngcontent-%COMP%]{font-size:1.2em;border-radius:6px;background-color:#175242;border:#175242;color:orange;font-weight:bold;padding:.4em}.main[_ngcontent-%COMP%]{display:flex;justify-content:space-around;height:600px;margin-top:1em}.week-container[_ngcontent-%COMP%]{color:#175242;font-size:2em;max-height:500px;display:flex;flex-direction:column;justify-content:space-between}.day[_ngcontent-%COMP%]{padding:1em;box-shadow:12.5px 12.5px 24.5px rgba(0,0,0,.035),100px 100px 196px rgba(0,0,0,.07);border-radius:6px}.day[_ngcontent-%COMP%]:hover{cursor:pointer;color:#f18f01;box-shadow:6.7px 6.7px 9px rgba(0,0,0,.027),22.3px 22.3px 30.2px rgba(0,0,0,.043),100px 100px 135px rgba(0,0,0,.07)}.users[_ngcontent-%COMP%]{min-width:500px}@media screen and (min-width: 300px) and (max-width: 1000px){.container[_ngcontent-%COMP%]{width:90%}.filters[_ngcontent-%COMP%]{width:100%}}@media screen and (min-width: 300px) and (max-width: 740px){.filters[_ngcontent-%COMP%]{flex-direction:column;height:200px}.main[_ngcontent-%COMP%]{flex-direction:column}.week-container[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap}.day[_ngcontent-%COMP%]{font-size:.8em}.users[_ngcontent-%COMP%]{min-width:200px}}\"]\n  });\n  return UserlistOrdersComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}