{"ast":null,"code":"import _asyncToGenerator from \"/Users/marinemichelot/Desktop/Aston/P1/gitcant/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/service/order.service\";\nimport * as i3 from \"@angular/common\";\n\nfunction CurrentOrderComponent_ul_4_li_1_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 3);\n    i0.ɵɵlistener(\"click\", function CurrentOrderComponent_ul_4_li_1_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const order_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.deleteOrder(order_r3.id);\n    });\n    i0.ɵɵtext(1, \"Annuler ma commande\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CurrentOrderComponent_ul_4_li_1_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 3);\n    i0.ɵɵlistener(\"click\", function CurrentOrderComponent_ul_4_li_1_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const order_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return ctx_r9.modifyOrder(order_r3.id);\n    });\n    i0.ɵɵtext(1, \"Modifier ma commande\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CurrentOrderComponent_ul_4_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵelementStart(2, \"p\", 6);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 7);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"a\", 8);\n    i0.ɵɵtext(7, \"Voir D\\u00E9tails\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, CurrentOrderComponent_ul_4_li_1_button_8_Template, 2, 0, \"button\", 9);\n    i0.ɵɵtemplate(9, CurrentOrderComponent_ul_4_li_1_button_9_Template, 2, 0, \"button\", 9);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const order_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" \", order_r3.creationDate, \" \\u00E0 \", order_r3.creationTime, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Statut : \", order_r3.status, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate2(\"routerLink\", \"/orderDetails/\", order_r3.id, \"/\", ctx_r2.userId, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", order_r3.status == \"En Attente\" && order_r3.creationDate > ctx_r2.todayDate);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", order_r3.status == \"En Attente\" && order_r3.creationDate > ctx_r2.todayDate);\n  }\n}\n\nfunction CurrentOrderComponent_ul_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\");\n    i0.ɵɵtemplate(1, CurrentOrderComponent_ul_4_li_1_Template, 10, 7, \"li\", 4);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.orders);\n  }\n}\n\nfunction CurrentOrderComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"p\");\n    i0.ɵɵtext(2, \"Cet utilisateur n'a pas encore de commande a son actif :( \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let CurrentOrderComponent = /*#__PURE__*/(() => {\n  class CurrentOrderComponent {\n    //-------------------- CONSTRUCTEUR ----------------------------------------------\n    constructor(router, route, orderService, datePipe) {\n      this.router = router;\n      this.route = route;\n      this.orderService = orderService;\n      this.datePipe = datePipe;\n      this.currentOrders = [];\n      this.userId = \"\";\n      this.msgError = \"\";\n      this.orders = [];\n      this.thereIsOrders = false;\n    } //-------------------- ON INIT ----------------------------------------------\n\n\n    ngOnInit() {\n      //RÉCUPÉRATION DE L'ID DE L'UTILISATEUR PAR UN SCREEN DE L'URL\n      this.userId = this.route.snapshot.paramMap.get('userId'); //Récuperation des commandes en cours pour l'utilisateur connecté\n\n      this.getOrdersForUser(this.userId);\n    } //----------------------- Récuperation des commandes en cours pour l'utilisateur connecté -----------------\n\n\n    getOrdersForUser(userId) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        //Requete asynchrone de recuperation des commande en cours pour l'utilisateur connecté\n        try {\n          let currentOrders = _this.orders = yield _this.orderService.getOrdersForUser(userId); //verification s'il y a des commandes en cours\n\n          if (currentOrders == \"\") {\n            _this.thereIsOrders = false;\n          } else {\n            _this.thereIsOrders = true;\n          }\n        } catch (error) {\n          if (error['status'] == 401) {\n            _this.msgError = \"Identifiant ou Mot de Passe Incorrect\";\n          } else {\n            _this.msgError = 'Problème rencontré : ' + error['status'] + ' ' + error.error['exceptionMessage']; //Formation du message d'erreur\n          }\n        } //Tris des commandes\n\n\n        _this.sortOrders();\n      })();\n    } //------------------------------- Tris des commandes en cours récuperées ----------------------------\n\n\n    sortOrders() {\n      //pour chaque commandes recuperée\n      this.orders.forEach(element => {\n        //Récuperation de la date du jour\n        let date = new Date();\n        this.todayDate = this.datePipe.transform(date, 'yyyy-MM-dd'); //Selon le status de la commande, attribution d'unestring explicative\n\n        switch (element.status) {\n          case 0:\n            element.status = \"En Attente\";\n            break;\n\n          case 1:\n            element.status = \"Délivrée\";\n            break;\n\n          case 2:\n            element.status = \"Annulée\";\n            break;\n        } //Push dans le tableau des commandes en cours\n\n\n        this.currentOrders.push(element);\n      });\n    } //-------------------- RETOURNE VERS LE MENU ----------------------------------------------\n\n\n    onReturnMenu() {\n      //REDIRECTION\n      this.router.navigate(['homepage']);\n    } //-------------------- DELETE ORDER ----------------------------------------------\n\n\n    deleteOrder(orderId) {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        //Requete asynchrone de suppression d'une commande\n        try {\n          //Requete APi de suppression d'une commande en cours\n          yield _this2.orderService.deleteOrder(orderId); //Récuperation de la liste des commandes en cours pour l'utilisateur connecté afin de resfresh la liste\n\n          _this2.getOrdersForUser(_this2.userId);\n        } catch (error) {\n          if (error['status'] == 401) {\n            _this2.msgError = \"Identifiant ou Mot de Passe Incorrect\";\n          } else {\n            _this2.msgError = 'Problème rencontré : ' + error['status'] + ' ' + error.error['exceptionMessage']; //Formation du message d'erreur\n          }\n        }\n      })();\n    } //-------------------- Modifier une commande en cours ----------------------------------------------\n\n\n    modifyOrder(orderId) {\n      return _asyncToGenerator(function* () {})();\n    } //-------------------- REDIRECTION VERS LA PAGE DES UTILISATEURS ----------------------------------------------\n\n\n    onReturnUsers() {\n      //REDIRECTION\n      this.router.navigate(['users']);\n    } //-------------------- REDIRECTION VERS LA PAGE DE L'UTILISATEUR CIBLÉ ----------------------------------------------\n\n\n    onReturnUser() {\n      //REDIRECTION\n      this.router.navigate(['user/' + this.userId]);\n    }\n\n  }\n\n  CurrentOrderComponent.ɵfac = function CurrentOrderComponent_Factory(t) {\n    return new (t || CurrentOrderComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.OrderService), i0.ɵɵdirectiveInject(i3.DatePipe));\n  };\n\n  CurrentOrderComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CurrentOrderComponent,\n    selectors: [[\"app-current-order\"]],\n    decls: 12,\n    vars: 2,\n    consts: [[1, \"contain-order\"], [1, \"contain-inprogress\"], [4, \"ngIf\"], [3, \"click\"], [4, \"ngFor\", \"ngForOf\"], [1, \"contain-order-details\"], [1, \"date\"], [1, \"status\"], [3, \"routerLink\"], [3, \"click\", 4, \"ngIf\"]],\n    template: function CurrentOrderComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"main\", 0);\n        i0.ɵɵelementStart(1, \"section\", 1);\n        i0.ɵɵelementStart(2, \"h2\");\n        i0.ɵɵtext(3, \"Commandes en cours\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, CurrentOrderComponent_ul_4_Template, 2, 1, \"ul\", 2);\n        i0.ɵɵtemplate(5, CurrentOrderComponent_div_5_Template, 3, 0, \"div\", 2);\n        i0.ɵɵelementStart(6, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function CurrentOrderComponent_Template_button_click_6_listener() {\n          return ctx.onReturnUsers();\n        });\n        i0.ɵɵtext(7, \"Retour vers la lsite des utilisateurs\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function CurrentOrderComponent_Template_button_click_8_listener() {\n          return ctx.onReturnUser();\n        });\n        i0.ɵɵtext(9, \"Retour vers l'utilisateur\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function CurrentOrderComponent_Template_button_click_10_listener() {\n          return ctx.onReturnMenu();\n        });\n        i0.ɵɵtext(11, \"Retour vers Menu\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.thereIsOrders);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.thereIsOrders);\n      }\n    },\n    directives: [i3.NgIf, i3.NgForOf, i1.RouterLinkWithHref],\n    styles: [\"\"]\n  });\n  return CurrentOrderComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}