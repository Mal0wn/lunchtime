{"ast":null,"code":"import _asyncToGenerator from \"/Users/marinemichelot/Desktop/Aston/P1/gitcant/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { ModifyOrderComponent } from './modify-order/modify-order.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/service/order.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/dialog\";\n\nfunction OrderComponent_ul_4_li_1_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 3);\n    i0.ɵɵlistener(\"click\", function OrderComponent_ul_4_li_1_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const order_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.deleteOrder(order_r3.id);\n    });\n    i0.ɵɵtext(1, \"Annuler ma commande\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction OrderComponent_ul_4_li_1_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 3);\n    i0.ɵɵlistener(\"click\", function OrderComponent_ul_4_li_1_button_11_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const order_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return ctx_r9.modifyOrder(order_r3.id);\n    });\n    i0.ɵɵtext(1, \"Modifier ma commande\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction OrderComponent_ul_4_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵelementStart(2, \"p\", 6);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 7);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 8);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"a\", 9);\n    i0.ɵɵtext(9, \"Voir D\\u00E9tails\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, OrderComponent_ul_4_li_1_button_10_Template, 2, 0, \"button\", 10);\n    i0.ɵɵtemplate(11, OrderComponent_ul_4_li_1_button_11_Template, 2, 0, \"button\", 10);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const order_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" \", order_r3.creationDate, \" \\u00E0 \", order_r3.creationTime, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Statut : \", order_r3.status, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", order_r3.price, \" Cr\\u00E9dit(s)\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate2(\"routerLink\", \"/orderDetails/\", order_r3.id, \"/\", ctx_r2.userId, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", order_r3.status == \"En Attente  && order.creationDate > todayDate\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", order_r3.status == \"En Attente\" && order_r3.creationDate > ctx_r2.todayDate);\n  }\n}\n\nfunction OrderComponent_ul_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\");\n    i0.ɵɵtemplate(1, OrderComponent_ul_4_li_1_Template, 12, 8, \"li\", 4);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.orders);\n  }\n}\n\nfunction OrderComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"p\");\n    i0.ɵɵtext(2, \"Vous n'avez pas de commandes en cours ! N'h\\u00E9sitez pas la carte offre de tr\\u00E8s bon choix aujourd'hui ^^\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let OrderComponent = /*#__PURE__*/(() => {\n  class OrderComponent {\n    //-------------------- CONSTRUCTEUR ----------------------------------------------\n    constructor(router, route, orderService, datePipe, dialog) {\n      this.router = router;\n      this.route = route;\n      this.orderService = orderService;\n      this.datePipe = datePipe;\n      this.dialog = dialog;\n      this.currentOrders = [];\n      this.userId = \"\";\n      this.msgError = \"\";\n      this.orders = [];\n      this.thereIsOrders = false;\n    } //-------------------- ON INIT ----------------------------------------------\n\n\n    ngOnInit() {\n      //RÉCUPÉRATION DE L'ID DE L'UTILISATEUR PAR UN SCREEN DE L'URL\n      this.userId = this.route.snapshot.paramMap.get('userId');\n      this.getOrdersForUser(this.userId);\n    }\n\n    getOrdersForUser(userId) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          _this.orders = yield _this.orderService.getOrdersForUser(userId);\n\n          if (_this.orders == \"\") {\n            _this.thereIsOrders = false;\n          } else {\n            _this.thereIsOrders = true;\n          }\n        } catch (error) {\n          if (error['status'] == 401) {\n            _this.msgError = \"Identifiant ou Mot de Passe Incorrect\";\n          } else {\n            _this.msgError = 'Problème rencontré : ' + error['status'] + ' ' + error.error['exceptionMessage']; //Formation du message d'erreur\n          }\n        } //Tris des commandes\n\n\n        _this.sortOrders();\n\n        _this.orders.sort((a, b) => {\n          return b.id - a.id;\n        });\n      })();\n    } //--------------------- TRIS DE COMMANDES DE L'UTILISATEUR --------------------------------\n\n\n    sortOrders() {\n      //Pour toutes les commandes recuperées\n      this.orders.forEach(element => {\n        //récuperation de la date actuelle\n        let date = new Date();\n        this.todayDate = this.datePipe.transform(date, 'yyyy-MM-dd'); //Selon le status de la commande, on lui attribut une string de définition\n\n        switch (element.status) {\n          case 0:\n            element.status = \"En Attente\";\n            break;\n\n          case 1:\n            element.status = \"Délivrée\";\n            break;\n\n          case 2:\n            element.status = \"Annulée\";\n            break;\n        } //Push dans le tableau des commandes\n\n\n        this.currentOrders.push(element);\n      });\n    } //-------------------- RETOURNE VERS LE MENU ----------------------------------------------\n\n\n    onReturnMenu() {\n      //REDIRECTION\n      this.router.navigate(['homepage']);\n    } //-------------------- Suppression de la commande ---------------------------\n\n\n    deleteOrder(orderId) {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          yield _this2.orderService.deleteOrder(orderId);\n          _this2.orders[_this2.orders.findIndex(e => e.id == orderId)].status = 2;\n\n          _this2.sortOrders();\n        } catch (error) {\n          if (error['status'] == 401) {\n            _this2.msgError = \"Identifiant ou Mot de Passe Incorrect\";\n          } else {\n            _this2.msgError = 'Problème rencontré : ' + error['status'] + ' ' + error.error['exceptionMessage']; //Formation du message d'erreur\n          }\n        }\n      })();\n    } //-------------------- Modification de  la commande ---------------------------\n\n\n    modifyOrder(order) {\n      var _this3 = this;\n\n      return _asyncToGenerator(function* () {\n        try {\n          let tmpOrder = {\n            userId: order.user.id,\n            constraintId: -1,\n            quantity: []\n          };\n          let quant = [];\n          order.quantity.forEach( /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (item) {\n              let tmpQuant = {\n                quantity: item.quantite,\n                mealId: item.meal.id\n              };\n              quant.push(tmpQuant);\n            });\n\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n          tmpOrder.quantity = quant;\n          tmpOrder.constraintId = -1;\n          yield _this3.orderService.updateOrder(tmpOrder, order.id);\n          _this3.orders[_this3.orders.findIndex(e => e.id == order.id)] = order;\n        } catch (error) {\n          if (error['status'] == 401) {\n            _this3.msgError = \"vous n'etes pas connecté !\";\n          } else {\n            _this3.msgError = 'Problème rencontré : ' + error['status'] + ' ' + error.error['exceptionMessage']; //Formation du message d'erreur\n          }\n        }\n      })();\n    }\n\n    displayModal(order) {\n      var _this4 = this;\n\n      return _asyncToGenerator(function* () {\n        let tmp;\n\n        let modal = _this4.dialog.open(ModifyOrderComponent, {\n          autoFocus: true,\n          data: {\n            order: order\n          }\n        });\n\n        modal.afterClosed().subscribe(item => {\n          tmp = item;\n        }, undefined, () => {\n          console.log(\"check :\", tmp);\n\n          if (tmp) {\n            if (tmp.modalStatus == -1) {\n              _this4.deleteOrder(order.id);\n            } else if (tmp.modalStatus == 1) {\n              console.log(tmp);\n              delete tmp.modalStatus;\n\n              _this4.modifyOrder(tmp);\n            }\n          }\n        });\n      })();\n    }\n\n  }\n\n  OrderComponent.ɵfac = function OrderComponent_Factory(t) {\n    return new (t || OrderComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.OrderService), i0.ɵɵdirectiveInject(i3.DatePipe), i0.ɵɵdirectiveInject(i4.MatDialog));\n  };\n\n  OrderComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: OrderComponent,\n    selectors: [[\"app-order\"]],\n    decls: 8,\n    vars: 2,\n    consts: [[1, \"contain-order\"], [1, \"contain-inprogress\"], [4, \"ngIf\"], [3, \"click\"], [4, \"ngFor\", \"ngForOf\"], [1, \"contain-order-details\"], [1, \"date\"], [1, \"status\"], [1, \"price\"], [3, \"routerLink\"], [3, \"click\", 4, \"ngIf\"]],\n    template: function OrderComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"main\", 0);\n        i0.ɵɵelementStart(1, \"section\", 1);\n        i0.ɵɵelementStart(2, \"h2\");\n        i0.ɵɵtext(3, \"Commandes en cours\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, OrderComponent_ul_4_Template, 2, 1, \"ul\", 2);\n        i0.ɵɵtemplate(5, OrderComponent_div_5_Template, 3, 0, \"div\", 2);\n        i0.ɵɵelementStart(6, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function OrderComponent_Template_button_click_6_listener() {\n          return ctx.onReturnMenu();\n        });\n        i0.ɵɵtext(7, \"Retour vers Menu\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.thereIsOrders);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.thereIsOrders);\n      }\n    },\n    directives: [i3.NgIf, i3.NgForOf, i1.RouterLinkWithHref],\n    styles: [\".contain-order[_ngcontent-%COMP%]{width:70%;margin:2em auto;display:flex;flex-direction:column;justify-content:center}h2[_ngcontent-%COMP%]{text-align:center;font-size:2em;color:#175242;margin-bottom:2em}ul[_ngcontent-%COMP%]{justify-content:center;display:flex;flex-direction:column;background-color:#86cb92;padding:2em;border-radius:6px;width:60%;margin-left:auto;margin-right:auto;margin-bottom:4em}li[_ngcontent-%COMP%]{display:flex;list-style-type:none;margin-bottom:2em;width:50%;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}.date[_ngcontent-%COMP%]{color:#175242;font-weight:bold}.price[_ngcontent-%COMP%]{color:#646464}a[_ngcontent-%COMP%]{background-color:#f18f18;color:#175242;font-weight:bold;padding:.5em;border-radius:6px;text-decoration:none}button[_ngcontent-%COMP%]{background-color:#175242;color:orange;width:20%;margin:2em auto;padding:.5em;border-radius:6px;border:1px solid white;cursor:pointer}.contain-past[_ngcontent-%COMP%]{display:flex;flex-direction:column}\"]\n  });\n  return OrderComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}